name: Release

on:
  release:
    types: [published]
  push:
    branches: [main]

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v3

      - name: Setup
        uses: ./.github/actions/setup

      - name: Setup Dependencies 💚
        run: |
          pnpm install
      - name: Zip It Up 🤐
        run: |
          pnpm build
          zip -r fake-agora-rtc.zip dist
      - name: Upload Artifact ⬆️
        uses: actions/upload-artifact@v3
        with:
          name: fake-agora-rtc.zip
          path: fake-agora-rtc.zip
      - name: Upload Doc Archive to GitHub release ⬆️
        if: github.event.release
        uses: svenstaro/upload-release-action@2.6.0
        with:
          file: fake-agora-rtc.zip
          asset_name: fake-agora-rtc.zip
          tag: ${{ github.ref_name }}
